---
description:
globs:
alwaysApply: false
---
# Architecture API MCP
> Derni√®re mise √† jour: 7 janvier 2025

## Structure de l'API

### Points d'entr√©e principaux
- **API legacy**: [api.py](mdc:api.py) - Interface simple avec routeurs
- **API principale**: [src/api/main.py](mdc:src/api/main.py) - Application FastAPI compl√®te
- **Serveur**: [server.py](mdc:server.py) - Point d'entr√©e Uvicorn

### Modules API sp√©cialis√©s
- **Endpoints RAG**: [src/api/rag_endpoints.py](mdc:src/api/rag_endpoints.py)
- **Automation**: [src/api/automation_endpoints.py](mdc:src/api/automation_endpoints.py)
- **Lightning Router**: [lightning.py](mdc:lightning.py)
- **Sparkseer Router**: [server.py](mdc:server.py) (contient les routeurs)

### Structure des endpoints

**üìö Documentation compl√®te**: Voir [api-endpoints-production.mdc](mdc:.cursor/rules/api-endpoints-production.mdc) pour la liste exhaustive de tous les endpoints disponibles en production.

#### Exemples d'endpoints par cat√©gorie

**Simulation et optimisation**
```python
POST /api/v1/simulate/node
GET /api/v1/simulate/profiles
POST /api/v1/optimize/node/{node_id}
```

**Monitoring et status**
```python
GET /health
GET /api/v1/status
GET /metrics/prometheus
```

**Stockage et fichiers**
```python
POST /api/v1/storage/upload
GET /api/v1/storage/download
```

**Administration (auth requise)**
```python
GET /api/v1/admin/metrics
POST /api/v1/admin/maintenance
```

### Int√©grations externes
- **Supabase**: Stockage de fichiers et donn√©es
- **LNBits**: Interface Lightning Network
- **MongoDB**: Base de donn√©es principale
- **Redis**: Cache et files d'attente
- **Prometheus**: M√©triques et monitoring

### Authentification et s√©curit√©
- **JWT**: Tokens avec tenant isolation
- **CORS**: Restriction par origine (app.dazno.de)
- **Rate limiting**: Protection contre le spam
- **Middleware**: Logging, s√©curit√©, monitoring

### Configuration Docker
- **D√©veloppement**: [docker-compose.yml](mdc:docker-compose.yml)
- **Production**: [docker-compose.prod.yml](mdc:docker-compose.prod.yml)
- **Tests**: [docker-compose.test.yml](mdc:docker-compose.test.yml)

### Health checks et monitoring
- Health check sur `/health`
- M√©triques Prometheus sur `/metrics`
- Dashboard Grafana int√©gr√©
- Alertes automatiques via Telegram
