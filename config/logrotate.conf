# Logrotate configuration for MCP API
# Dernière mise à jour: 12 octobre 2025
# 
# Installation:
# sudo cp config/logrotate.conf /etc/logrotate.d/mcp-api
# sudo chown root:root /etc/logrotate.d/mcp-api
# sudo chmod 644 /etc/logrotate.d/mcp-api

# MCP API logs
/home/feustey/mcp-production/logs/*.log {
    # Rotation quotidienne
    daily
    
    # Garder 30 jours d'historique
    rotate 30
    
    # Compresser les anciens logs
    compress
    delaycompress
    
    # Ne pas lever d'erreur si le fichier manque
    missingok
    
    # Ne pas faire de rotation si le log est vide
    notifempty
    
    # Créer les nouveaux logs avec les bonnes permissions
    create 0644 feustey feustey
    
    # Date dans le nom du fichier
    dateext
    dateformat -%Y%m%d
    
    # Extension après la date
    extension .log
    
    # Script post-rotation
    postrotate
        # Recharger le service si nécessaire
        if systemctl is-active mcp-api >/dev/null 2>&1; then
            systemctl reload mcp-api >/dev/null 2>&1 || true
        fi
    endscript
    
    # Limites de taille (en plus de daily)
    size 100M
    maxsize 500M
}

# Logs systemd séparés
/home/feustey/mcp-production/logs/api_systemd.log
/home/feustey/mcp-production/logs/api_systemd_error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 feustey feustey
    dateext
    size 100M
}

# Logs de monitoring
/home/feustey/mcp-production/monitoring_data/*.log {
    weekly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 0644 feustey feustey
    dateext
}

