#!/usr/bin/expect -f

set timeout 60
set host "147.79.101.32"
set user "feustey"
set password "Feustey@AI!"

# CrÃ©er le rÃ©pertoire MCP et transfÃ©rer les fichiers
spawn ssh -o StrictHostKeyChecking=no $user@$host "mkdir -p /home/feustey/MCP/scripts"
expect {
    "*password:*" {
        send "$password\r"
        exp_continue
    }
    eof
}

puts "ğŸ“ RÃ©pertoire MCP crÃ©Ã©"

# TransfÃ©rer les fichiers
spawn scp -o StrictHostKeyChecking=no deployment_package/daily_daznode_report.py deployment_package/daily_app_health_report.py deployment_package/DEPLOY_NOW.sh deployment_package/TEST_RAPPORTS_PRODUCTION.py deployment_package/install_daily_reports_cron.sh $user@$host:/home/feustey/MCP/scripts/
expect {
    "*password:*" {
        send "$password\r"
        exp_continue
    }
    eof
}

puts "ğŸ“¦ Fichiers transfÃ©rÃ©s"

# DÃ©ployer et tester
spawn ssh -o StrictHostKeyChecking=no $user@$host "cd /home/feustey/MCP && chmod +x scripts/*.py scripts/*.sh && ./scripts/DEPLOY_NOW.sh"
expect {
    "*password:*" {
        send "$password\r"
        exp_continue
    }
    eof
}

puts "ğŸš€ DÃ©ploiement terminÃ©"